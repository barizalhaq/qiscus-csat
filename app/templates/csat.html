{% extends "base.html" %}

{% block main %}
<div class="row mt-5">
    <div class="col-md-10 m-auto">
      <div class="text-center mb-5">
        <img src="{{extras['logo']}}" alt="" width="190px" />
      </div>

      <h1 class="text-center mb-3">{{csat.app.app_name}} Customer Satisfaction Survey</h1>
      <h5 class="text-center" style="margin-bottom: 50px">
        Hanya kurang dari 1 menit, saran dan masukan {{csat.app.app_name}} Partner sangat berarti bagi kami untuk terus dapat melakukan peningkatan pelayanan yang lebih baik lagi. Mohon berikan penilaian atas pelayanan {{csat.app.app_name}}.
      </h5>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {{message}}
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="POST" action="/csat">
        <input type="text" name="csat_code" id="csat_code" value="{{csat.csat_code}}" hidden />
        <h5 class="text-center">
          Dari skala 1 – {{csat.app.config.rating_total}}, berapa nilai yang {{csat.app.app_name}} Partner berikan atas keseluruhan pengalaman pelayanan bersama {{csat.app.app_name}} (1 = buruk sekali, {{csat.app.config.rating_total}} = baik sekali)
        </h5>
        <div class="form-group pb-3 pt-3" style="display: flex; justify-content: center">
          <select name="rating" id="rating" autocomplete="off">
            <option value=""></option>
          </select>
        </div>

        <div class="form-group">
          <h5>Mohon kesediaan {{csat.app.app_name}} Partner untuk memberikan saran perbaikan atas pelayanan {{csat.app.app_name}}.</h5>
          
          {% if 'rating_min_fb' in extras %}
          	<label for="feedback"><i>Jika mengisi nilai 1 – {{extras['rating_min_fb']}}, maka wajib mengisi kolom alasan</i></label>
          {% endif %}

          <textarea class="form-control" id="feedback" name="feedback" rows="5" maxlength="1000"></textarea>
        </div>
        <div class="form-group" style="display: flex; justify-content: center">
          <button type="submit" class="btn btn-primary">Kirim Survey</button>
        </div>
      </form>
    </div>
  </div>
{% endblock %}

{% block script %}

<script type="text/javascript">

	const ratingType = '{{csat.app.config.rating_type.name}}'
	const ratingTotal = '{{csat.app.config.rating_total}}'

	for (i = 1; i <= ratingTotal; i++) {
		$('#rating')
         	.append($('<option>', { value : i })
         	.text(i));
	}

	function ratingEnable() {
		if (ratingType == 'STAR') {
			$('#rating').barrating('show', {
				theme: 'fontawesome-stars',
				showSelectedRating: false,
			});
		} else {
			$('#rating').barrating('show', {
				theme: 'bars-square',
				showValues: true,
				showSelectedRating: false,
			});
		}
	}

	ratingEnable();
</script>

{% endblock %}